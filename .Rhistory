fc = read.csv(choose.files(), header = T)
hs = read.csv(choose.files(), header = T)
visits = read.csv(choose.files(), header = T)
inventory_wide = read.csv(choose.files(), header = T)
inv_avg_nutri = read.csv(choose.files(), header = T)
nv_avg_nutri <- inv_avg_nutri[, -c(1)]
inv_avg_nutri$StartDate <- as.Date(inv_avg_nutri$StartDate, format = '%m/%d/%Y')
inv_avg_nutri$EndDate <- as.Date(inv_avg_nutri$EndDate, format = '%m/%d/%Y')
hs <- hs[,-c(2)] #remove the individual_id field
library(sqldf)
library(ggplot2)
hsdistinctquery <- 'select afn, served_date, avg(num_male) as num_male, avg(num_female) as num_female, avg(num_african_american) as num_african_american, avg(num_white) as num_white,
avg(num_american_indian) as num_american_indians, avg(num_asian) as num_asian, avg(num_hawaiian_or_pacific_islander) as num_hawaiian_or_pacific_islander,
avg(num_multi_race) as num_multi_race, avg(num_other_race) as num_other_race, avg(hispanic_or_latino) as hispanic_or_latino, avg(not_hispanic) as not_hispanic,
avg(upTo_8thGrade) as upTo_8thGrade, avg(X9to12_nonGrad) as HighSchoolnon_Grad, avg(hsGrad_Ged) as hsGrad_Ged, avg(hsGrad_or_Ged_some_secondary) as hsGrad_or_Ged_some_secondary,
avg(X2_or_4_college_grad) as college_grad, avg(annual_income) as annual_income, avg(fed_poverty_level) as fed_poverty_level from hs group by afn, served_date'
hs_done <- sqldf(hsdistinctquery)
itemsQuery <- 'select afn, trans_id, ts, avg(nutriScoreValue) as avgNutriScore, count(*) as items from fc group by afn, trans_id, ts order by ts desc'
fcbyPurchase <- sqldf(itemsQuery)
fcjoinvis <- 'select fcbyPurchase.*, serviceDate, individual_id, gender, race, ethnicity, dob, numInHousehold as hs_size from fcbyPurchase join visits on fcbyPurchase.ts = visits.ts and fcbyPurchase.afn = visits.afn and fcbyPurchase.trans_id = visits.trans_id'
fc_vis <- sqldf(fcjoinvis)
fc_join_hs <- "select distinct * from fc_vis join hs_done on fc_vis.serviceDate = hs_done.served_date and fc_vis.afn = hs_done.afn"
fchs_final <- sqldf(fc_join_hs)
summary(fchs_final)
head(fchs_final$ts)
fchs_final$time = as.Date(fchs_final$ts, format = "%Y-%m-%d")
dummyVar1 = c("2017-9-1")
startDate = as.Date(dummyVar1, format = "%Y-%m-%d")
ggplot(data = fchs_final) + geom_point(aes(x = time, y = avgNutriScore)) + geom_smooth(aes(x = time, y = avgNutriScore, alpha = I(.4))) + geom_vline(xintercept = startDate, col = "Red")
ggplot(data = fchs_final) + geom_point(aes(x = time, y = items)) + geom_smooth(aes(x = time, y = items, alpha = I(.4))) + geom_vline(xintercept = startDate, col = "Red")
library(sqldf)
library(car)
library(ggplot2)
ggplot(data = fchs_final) + geom_point(aes(x = time, y = avgNutriScore)) + geom_smooth(aes(x = time, y = avgNutriScore, alpha = I(.4))) + geom_vline(xintercept = projectStartDate, col = "Red")
ggplot(data = fchs_final) + geom_point(aes(x = time, y = items)) + geom_smooth(aes(x = time, y = items, alpha = I(.4))) + geom_vline(xintercept = projectStartDate, col = "Red")
projectStartDate = as.Date(dummyVar1, format = "%Y-$m-%d") #Variable to hold the date when the initiative was started
fchs_final$time = as.Date(fchs_final$ts, format = "%Y-%m-%d")
dummyVar1 = c("2017-9-1")
projectStartDate = as.Date(dummyVar1, format = "%Y-$m-%d") #Variable to hold the date when the initiative was started
ggplot(data = fchs_final) + geom_point(aes(x = time, y = avgNutriScore)) + geom_smooth(aes(x = time, y = avgNutriScore, alpha = I(.4))) + geom_vline(xintercept = projectStartDate, col = "Red")
ggplot(data = fchs_final) + geom_point(aes(x = time, y = items)) + geom_smooth(aes(x = time, y = items, alpha = I(.4))) + geom_vline(xintercept = projectStartDate, col = "Red")
ggplot(data = fchs_final) + geom_point(aes(x = time, y = avgNutriScore)) + geom_smooth(aes(x = time, y = avgNutriScore, alpha = I(.4))) + geom_vline(xintercept = startDate, col = "Red")
ggplot(data = fchs_final) + geom_point(aes(x = time, y = items)) + geom_smooth(aes(x = time, y = items, alpha = I(.4))) + geom_vline(xintercept = startDate, col = "Red")
ggplot(data = fchs_final) + geom_point(aes(x = time, y = avgNutriScore), alpha = I(.4)) + geom_smooth(aes(x = time, y = avgNutriScore, alpha = I(.4))) + geom_vline(xintercept = startDate, col = "Red")
ggplot(data = fchs_final) + geom_point(aes(x = time, y = items), alpha = I(.4)) + geom_smooth(aes(x = time, y = items, alpha = I(.4))) + geom_vline(xintercept = startDate, col = "Red")
remove(startDate)
dummyVar1
projectStartDate = as.Date(dummyVar1, format = "%Y-%m-%d")
library(sqldf)
library(car)
library(ggplot2)
install.packages(car)
ggplot(data = fchs_final) + geom_point(aes(x = time, y = avgNutriScore)) + geom_smooth(aes(x = time, y = avgNutriScore, alpha = I(.4))) + geom_vline(xintercept = projectStartDate, col = "Red")
ggplot(data = fchs_final) + geom_point(aes(x = time, y = items)) + geom_smooth(aes(x = time, y = items, alpha = I(.4))) + geom_vline(xintercept = projectStartDate, col = "Red")
ggplot(data = fchs_final) + geom_point(aes(x = time, y = avgNutriScore)) + geom_smooth(aes(x = time, y = avgNutriScore, alpha = I(.4))) + geom_vline(xintercept = projectStartDate, col = "Red")
ggplot(data = fchs_final) + geom_point(aes(x = time, y = items)) + geom_smooth(aes(x = time, y = items, alpha = I(.4))) + geom_vline(xintercept = projectStartDate, col = "Red")
ggplot(data = fchs_final) + geom_point(aes(x = time, y = avgNutriScore, alpha = I(.4))) + geom_smooth(aes(x = time, y = avgNutriScore, alpha = I(.4))) + geom_vline(xintercept = projectStartDate, col = "Red")
ggplot(data = fchs_final) + geom_point(aes(x = time, y = items, alpha = I(.4))) + geom_smooth(aes(x = time, y = items, alpha = I(.4))) + geom_vline(xintercept = projectStartDate, col = "Red")
ggplot(data = fchs_final) + geom_point(aes(x = time, y = items, alpha = I(.4), color = hs_size)) + geom_smooth(aes(x = time, y = items, alpha = I(.4))) + geom_vline(xintercept = projectStartDate, col = "Red")
ggplot(data = fchs_final, as.factor(hs_size)) + geom_point(aes(x = time, y = items, alpha = I(.4), color = hs_size)) + geom_smooth(aes(x = time, y = items, alpha = I(.4))) + geom_vline(xintercept = projectStartDate, col = "Red")
ggplot(data = fchs_final) + geom_point(aes(x = time, y = items, alpha = I(.4), color = as.factor(hs_size))) + geom_smooth(aes(x = time, y = items, alpha = I(.4))) + geom_vline(xintercept = projectStartDate, col = "Red")
ggplot(data = fchs_final) + geom_point(aes(x = time, y = items, alpha = I(.4), color = as.factor(hs_size))) + geom_smooth(aes(x = time, y = items, alpha = I(.4), color = as.factor(hs_size))) + geom_vline(xintercept = projectStartDate, col = "Red")
ggplot(data = subset(fchs_final, hs_size < 8)) + geom_point(aes(x = time, y = items, alpha = I(.4), color = as.factor(hs_size))) + geom_smooth(aes(x = time, y = items, alpha = I(.4), color = as.factor(hs_size))) + geom_vline(xintercept = projectStartDate, col = "Red")
ggplot(data = subset(fchs_final, hs_size < 8)) + geom_point(aes(x = time, y = items, alpha = I(.4))) + geom_smooth(aes(x = time, y = items, alpha = I(.4), color = as.factor(hs_size))) + geom_vline(xintercept = projectStartDate, col = "Red")
ggplot(data = subset(fchs_final, hs_size < 8)) + geom_point(aes(x = time, y = avgNutriScore, alpha = I(.4))) + geom_smooth(aes(x = time, y = avgNutriScore, alpha = I(.4), color = as.factor(hs_size))) + geom_vline(xintercept = projectStartDate, col = "Red")
ggplot(data = subset(fchs_final, hs_size < 8)) + geom_point(aes(x = time, y = items, alpha = I(.4))) + geom_smooth(aes(x = time, y = items, alpha = I(.4), color = as.factor(hs_size)), se = FALSE) + geom_vline(xintercept = projectStartDate, col = "Red")
ggplot(data = subset(fchs_final, hs_size < 8)) + geom_point(aes(x = time, y = avgNutriScore, alpha = I(.4))) + geom_smooth(aes(x = time, y = avgNutriScore, alpha = I(.4), color = as.factor(hs_size)), se = FALSE) + geom_vline(xintercept = projectStartDate, col = "Red")
